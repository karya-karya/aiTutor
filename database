
create table public.profiles (
  id uuid references auth.users not null primary key,
  email text,
  full_name text,
  role text default 'student', -- student, teacher, admin
  level text, 
  department text, 
  xp integer default 0, -- Oyunlaştırma için puan
  badges text, -- Rozetler
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);


create table public.chat_sessions (
  id bigint generated by default as identity primary key,
  user_id uuid references public.profiles(id) not null,
  title text default 'Yeni Sohbet',
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);


create table public.chat_messages (
  id bigint generated by default as identity primary key,
  session_id bigint references public.chat_sessions(id) on delete cascade, -- Hangi oturuma ait?
  user_id uuid references public.profiles(id) not null,
  sender text not null, -- 'user' veya 'ai'
  message text not null,
  tool_type text default 'chat', 
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);


create table public.file_materials (
  id bigint generated by default as identity primary key,
  title text not null,
  description text,
  file_url text not null, -- Dosyanın linki
  uploaded_by uuid references public.profiles(id) not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);


alter table public.profiles enable row level security;
alter table public.chat_sessions enable row level security;
alter table public.chat_messages enable row level security;
alter table public.file_materials enable row level security;


create policy "Public Access Profiles" on public.profiles for all using (true);
create policy "Public Access Sessions" on public.chat_sessions for all using (true);
create policy "Public Access Messages" on public.chat_messages for all using (true);
create policy "Public Access Materials" on public.file_materials for all using (true);
