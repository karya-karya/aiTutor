
create table public.profiles (
  id uuid references auth.users not null primary key,
  email text,
  full_name text,
  role text default 'student', -- student, teacher, admin
  level text, 
  department text, 
  xp integer default 0, -- Oyunlaştırma için puan
  badges text, -- Rozetler
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

create table public.chat_sessions (
  id bigint generated by default as identity primary key,
  user_id uuid references public.profiles(id) not null,
  title text default 'Yeni Sohbet',
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);


create table public.chat_messages (
  id bigint generated by default as identity primary key,
  session_id bigint references public.chat_sessions(id) on delete cascade, -- Hangi oturuma ait?
  user_id uuid references public.profiles(id) not null,
  sender text not null, -- 'user' veya 'ai'
  message text not null,
  tool_type text default 'chat', 
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

